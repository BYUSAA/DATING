<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Metadatez</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="theme-toggle">
        <button id="theme-switcher"><i class="fas fa-moon"></i></button>
    </div>
    
    <header class="futuristic-header">
        <div class="logo-container">
            <div class="logo-particle" id="particle-1"></div>
            <div class="logo-particle" id="particle-2"></div>
            <div class="logo-particle" id="particle-3"></div>
            <h1>METADATEZ</h1>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="#" id="logout-link">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main class="profile-container">
        <div class="profile-sidebar">
            <div class="profile-card">
                <div class="profile-photos">
                    <div class="main-photo" id="main-photo">
                        <img src="https://via.placeholder.com/300" alt="Profile Photo" id="profile-img">
                    </div>
                    <div class="photo-thumbnails">
                        <div class="thumbnail active" data-index="0">
                            <img src="https://via.placeholder.com/100" alt="Thumbnail 1">
                        </div>
                        <div class="thumbnail" data-index="1">
                            <img src="https://via.placeholder.com/100" alt="Thumbnail 2">
                        </div>
                        <div class="thumbnail" data-index="2">
                            <img src="https://via.placeholder.com/100" alt="Thumbnail 3">
                        </div>
                    </div>
                </div>
                <div class="profile-info">
                    <h2 id="profile-name">Loading...</h2>
                    <p class="profile-age-location" id="profile-age-location">...</p>
                    <div class="profile-category">
                        <span class="category-badge" id="profile-category">Dating</span>
                    </div>
                    <div class="profile-subcategories" id="profile-subcategories">
                        <span class="subcategory-tag">Casual Dating</span>
                        <span class="subcategory-tag">Same City</span>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="action-button vanish" id="edit-profile">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                    <button class="action-button vanish" id="upgrade-account">
                        <i class="fas fa-gem"></i> Upgrade Account
                    </button>
                </div>
            </div>
            
            <div class="profile-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Profile Views</h4>
                        <p id="profile-views">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Likes</h4>
                        <p id="profile-likes">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Messages</h4>
                        <p id="profile-messages">0</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="profile-content">
            <div class="profile-tabs">
                <button class="tab-button active" data-tab="matches">Matches</button>
                <button class="tab-button" data-tab="messages">Messages</button>
                <button class="tab-button" data-tab="settings">Settings</button>
            </div>
            
            <div class="tab-content active" id="matches-tab">
                <h3>Your Matches</h3>
                <div class="matches-grid" id="matches-grid">
                    <!-- Matches will be loaded here -->
                    <div class="loading-matches">
                        <div class="loading-spinner"></div>
                        <p>Finding your perfect matches...</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="messages-tab">
                <h3>Your Messages</h3>
                <div class="messages-container" id="messages-container">
                    <!-- Messages will be loaded here -->
                    <div class="no-messages">
                        <i class="fas fa-comments"></i>
                        <p>No messages yet. Start connecting with people!</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="settings-tab">
                <h3>Account Settings</h3>
                <form id="settings-form">
                    <div class="form-group">
                        <label for="settings-name">Full Name</label>
                        <input type="text" id="settings-name" required>
                    </div>
                    <div class="form-group">
                        <label for="settings-email">Email</label>
                        <input type="email" id="settings-email" required>
                    </div>
                    <div class="form-group">
                        <label for="settings-password">New Password (leave blank to keep current)</label>
                        <input type="password" id="settings-password">
                    </div>
                    <div class="form-group">
                        <label for="settings-birthdate">Birthdate</label>
                        <input type="date" id="settings-birthdate" required>
                    </div>
                    <div class="form-group">
                        <label for="settings-gender">Gender</label>
                        <select id="settings-gender" required>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="non-binary">Non-binary</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Profile Photos</label>
                        <div class="photo-upload-container">
                            <div class="photo-upload-box" id="settings-photo-1">
                                <input type="file" id="settings-upload-1" accept="image/*" class="photo-input">
                                <label for="settings-upload-1" class="upload-label">
                                    <i class="fas fa-plus"></i>
                                    <span>Change Photo 1</span>
                                </label>
                                <div class="photo-preview"></div>
                                <button type="button" class="remove-photo"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="photo-upload-box" id="settings-photo-2">
                                <input type="file" id="settings-upload-2" accept="image/*" class="photo-input">
                                <label for="settings-upload-2" class="upload-label">
                                    <i class="fas fa-plus"></i>
                                    <span>Change Photo 2</span>
                                </label>
                                <div class="photo-preview"></div>
                                <button type="button" class="remove-photo"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="photo-upload-box" id="settings-photo-3">
                                <input type="file" id="settings-upload-3" accept="image/*" class="photo-input">
                                <label for="settings-upload-3" class="upload-label">
                                    <i class="fas fa-plus"></i>
                                    <span>Change Photo 3</span>
                                </label>
                                <div class="photo-preview"></div>
                                <button type="button" class="remove-photo"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="settings-video">Introduction Video</label>
                        <div class="video-upload-container">
                            <input type="file" id="settings-video" accept="video/*" class="video-input">
                            <label for="settings-video" class="video-upload-label">
                                <i class="fas fa-video"></i>
                                <span>Change Video</span>
                            </label>
                            <div class="video-preview"></div>
                            <button type="button" class="remove-video"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <button type="submit" class="submit-button vanish">Save Changes</button>
                </form>
                
                <div class="danger-zone">
                    <h4>Danger Zone</h4>
                    <button class="danger-button vanish" id="delete-account">
                        <i class="fas fa-trash"></i> Delete Account
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Match Modal -->
    <div id="match-modal" class="modal">
        <div class="modal-content match-modal-content">
            <span class="close-modal">&times;</span>
            <div class="match-modal-header">
                <h2>You've Got a Match!</h2>
                <p>Start chatting with your new connection</p>
            </div>
            <div class="match-modal-body">
                <div class="match-user-card">
                    <div class="match-user-photo">
                        <img src="https://via.placeholder.com/150" alt="Match Photo" id="match-photo">
                    </div>
                    <div class="match-user-info">
                        <h3 id="match-name">Loading...</h3>
                        <p class="match-age-location" id="match-age-location">...</p>
                        <div class="match-user-bio" id="match-bio">
                            Bio loading...
                        </div>
                    </div>
                </div>
                <div class="match-actions">
                    <button class="match-action-button vanish" id="send-message">
                        <i class="fas fa-comment"></i> Send Message
                    </button>
                    <button class="match-action-button secondary vanish" id="view-profile">
                        <i class="fas fa-user"></i> View Profile
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="auth.js"></script>
    <script>
        // Load profile data
        document.addEventListener('DOMContentLoaded', function() {
            const user = auth.getCurrentUser();
            
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            // Populate profile info
            document.getElementById('profile-name').textContent = user.name;
            document.getElementById('profile-age-location').textContent = '32 • New York, NY';
            document.getElementById('profile-category').textContent = user.category.charAt(0).toUpperCase() + user.category.slice(1);
            
            // Populate subcategories
            const subcategoriesContainer = document.getElementById('profile-subcategories');
            subcategoriesContainer.innerHTML = '';
            user.subcategories.forEach(subcat => {
                const tag = document.createElement('span');
                tag.className = 'subcategory-tag';
                tag.textContent = subcat;
                subcategoriesContainer.appendChild(tag);
            });
            
            // Populate settings form
            document.getElementById('settings-name').value = user.name;
            document.getElementById('settings-email').value = user.email;
            document.getElementById('settings-birthdate').value = user.birthdate;
            document.getElementById('settings-gender').value = user.gender;
            
            // Load fake matches
            setTimeout(() => {
                loadMatches();
            }, 1500);
            
            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab button
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Update active tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Photo thumbnail click
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    
                    // Update active thumbnail
                    document.querySelectorAll('.thumbnail').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Update main photo (in a real app, this would show the actual photo)
                    document.getElementById('profile-img').src = `https://via.placeholder.com/300?text=Photo+${parseInt(index)+1}`;
                });
            });
            
            // Edit profile button
            document.getElementById('edit-profile').addEventListener('click', function() {
                document.querySelector('.tab-button[data-tab="settings"]').click();
            });
            
            // Upgrade account button
            document.getElementById('upgrade-account').addEventListener('click', function() {
                window.location.href = 'subscription.html';
            });
            
            // Logout link
            document.getElementById('logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                auth.logout();
                window.location.href = 'index.html';
            });
            
            // Settings form submission
            document.getElementById('settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const updates = {
                    name: document.getElementById('settings-name').value.trim(),
                    email: document.getElementById('settings-email').value.trim(),
                    birthdate: document.getElementById('settings-birthdate').value,
                    gender: document.getElementById('settings-gender').value
                };
                
                const newPassword = document.getElementById('settings-password').value;
                if (newPassword) {
                    updates.password = newPassword;
                }
                
                auth.updateProfile(user.id, updates);
                alert('Profile updated successfully!');
                
                // Update profile display
                document.getElementById('profile-name').textContent = updates.name;
            });
            
            // Delete account button
            document.getElementById('delete-account').addEventListener('click', function() {
                if (confirm('Are you sure you want to delete your account? This cannot be undone.')) {
                    auth.logout();
                    
                    // In a real app, you would send a request to the server to delete the account
                    // For this demo, we'll just redirect to the homepage
                    window.location.href = 'index.html';
                }
            });
            
            // Photo upload functionality for settings
            document.querySelectorAll('#settings-form .photo-input').forEach(input => {
                input.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const photoBox = e.target.closest('.photo-upload-box');
                        const preview = photoBox.querySelector('.photo-preview');
                        
                        preview.style.backgroundImage = `url(${event.target.result})`;
                        photoBox.classList.add('has-photo');
                    };
                    reader.readAsDataURL(file);
                });
            });
            
            document.querySelectorAll('#settings-form .remove-photo').forEach(button => {
                button.addEventListener('click', function() {
                    const photoBox = this.closest('.photo-upload-box');
                    const preview = photoBox.querySelector('.photo-preview');
                    const input = photoBox.querySelector('.photo-input');
                    
                    preview.style.backgroundImage = '';
                    photoBox.classList.remove('has-photo');
                    input.value = '';
                });
            });
            
            // Video upload functionality for settings
            document.querySelector('#settings-form .video-input').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const videoContainer = e.target.closest('.video-upload-container');
                    const preview = videoContainer.querySelector('.video-preview');
                    
                    const video = document.createElement('video');
                    video.src = event.target.result;
                    video.controls = true;
                    
                    preview.innerHTML = '';
                    preview.appendChild(video);
                    videoContainer.classList.add('has-video');
                };
                reader.readAsDataURL(file);
            });
            
            document.querySelector('#settings-form .remove-video').addEventListener('click', function() {
                const videoContainer = this.closest('.video-upload-container');
                const preview = videoContainer.querySelector('.video-preview');
                const input = videoContainer.querySelector('.video-input');
                
                preview.innerHTML = '';
                videoContainer.classList.remove('has-video');
                input.value = '';
            });
        });
        
        // Load fake matches
        function loadMatches() {
            const matchesGrid = document.getElementById('matches-grid');
            matchesGrid.innerHTML = '';
            
            const fakeMatches = [
                { id: 1, name: 'Alex Johnson', age: 28, location: 'Chicago, IL', photo: 'https://randomuser.me/api/portraits/men/32.jpg', category: 'Dating', subcategories: ['Serious Relationship', 'Same City'] },
                { id: 2, name: 'Sarah Miller', age: 25, location: 'Boston, MA', photo: 'https://randomuser.me/api/portraits/women/44.jpg', category: 'Marriage', subcategories: ['Ready to Marry'] },
                { id: 3, name: 'Jamie Smith', age: 30, location: 'Seattle, WA', photo: 'https://randomuser.me/api/portraits/women/68.jpg', category: 'Friendship', subcategories: ['Activity Partners'] },
                { id: 4, name: 'Taylor Brown', age: 27, location: 'Austin, TX', photo: 'https://randomuser.me/api/portraits/men/75.jpg', category: 'Dating', subcategories: ['Casual Dating'] },
                { id: 5, name: 'Morgan Lee', age: 31, location: 'Denver, CO', photo: 'https://randomuser.me/api/portraits/women/25.jpg', category: 'Business', subcategories: ['Professionals'] },
                { id: 6, name: 'Jordan Wilson', age: 29, location: 'Miami, FL', photo: 'https://randomuser.me/api/portraits/men/55.jpg', category: 'International', subcategories: ['Language Exchange'] }
            ];
            
            fakeMatches.forEach(match => {
                const matchCard = document.createElement('div');
                matchCard.className = 'match-card';
                matchCard.innerHTML = `
                    <div class="match-photo">
                        <img src="${match.photo}" alt="${match.name}">
                    </div>
                    <div class="match-info">
                        <h4>${match.name}</h4>
                        <p class="match-age-location">${match.age} • ${match.location}</p>
                        <div class="match-category">
                            <span class="category-badge">${match.category}</span>
                        </div>
                        <div class="match-subcategories">
                            ${match.subcategories.map(sub => `<span class="subcategory-tag">${sub}</span>`).join('')}
                        </div>
                    </div>
                    <div class="match-actions">
                        <button class="match-action vanish" data-match-id="${match.id}">
                            <i class="fas fa-heart"></i> Like
                        </button>
                        <button class="match-action secondary vanish" data-match-id="${match.id}">
                            <i class="fas fa-comment"></i> Message
                        </button>
                    </div>
                `;
                
                matchesGrid.appendChild(matchCard);
            });
            
            // Add event listeners to match buttons
            document.querySelectorAll('.match-action').forEach(button => {
                button.addEventListener('click', function() {
                    const matchId = this.getAttribute('data-match-id');
                    const match = fakeMatches.find(m => m.id == matchId);
                    
                    if (this.classList.contains('secondary')) {
                        // Message button - in a real app, this would open a chat
                        alert(`Messaging ${match.name}...`);
                    } else {
                        // Like button - show match modal
                        showMatchModal(match);
                    }
                });
            });
        }
        
        // Show match modal
        function showMatchModal(match) {
            document.getElementById('match-name').textContent = match.name;
            document.getElementById('match-age-location').textContent = `${match.age} • ${match.location}`;
            document.getElementById('match-photo').src = match.photo;
            document.getElementById('match-bio').textContent = `Hi there! I'm ${match.name.split(' ')[0]}, a ${match.age}-year-old from ${match.location.split(',')[0]}. Looking for ${match.subcategories.join(' and ')}. Let's connect!`;
            
            // Set up modal buttons
            document.getElementById('send-message').addEventListener('click', function() {
                alert(`Sending message to ${match.name}...`);
            });
            
            document.getElementById('view-profile').addEventListener('click', function() {
                alert(`Viewing ${match.name}'s profile...`);
            });
            
            // Show modal
            document.getElementById('match-modal').style.display = 'flex';
        }
        
        // Close match modal when clicking X
        document.querySelector('#match-modal .close-modal').addEventListener('click', function() {
            document.getElementById('match-modal').style.display = 'none';
        });
        
        // Close match modal when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target === document.getElementById('match-modal')) {
                document.getElementById('match-modal').style.display = 'none';
            }
        });
    </script>
</body>
</html>